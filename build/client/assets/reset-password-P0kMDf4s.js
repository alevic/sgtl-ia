var Ce=Object.defineProperty;var Me=(e,t,r)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var j=(e,t,r)=>Me(e,typeof t!="symbol"?t+"":t,r);import{r as te}from"./forgot-password-Cd1Knve9.js";var Ne={},fe={};const Z=Object.create(null),G=e=>{var t;return Ne||((t=globalThis.Deno)==null?void 0:t.env.toObject())||globalThis.__env__||(e?Z:globalThis)},T=new Proxy(Z,{get(e,t){return G()[t]??Z[t]},has(e,t){return t in G()||t in Z},set(e,t,r){const n=G(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=G(!0);return delete r[t],!0},ownKeys(){const e=G(!0);return Object.keys(e)}});function b(e,t){return typeof process<"u"&&fe?fe[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const V=1,v=4,M=8,_=24,de={eterm:v,cons25:v,console:v,cygwin:v,dtterm:v,gnome:v,hurd:v,jfbterm:v,konsole:v,kterm:v,mlterm:v,mosh:_,putty:v,st:v,"rxvt-unicode-24bit":_,terminator:_,"xterm-kitty":_},xe=new Map(Object.entries({APPVEYOR:M,BUILDKITE:M,CIRCLECI:_,DRONE:M,GITEA_ACTIONS:_,GITHUB_ACTIONS:_,GITLAB_CI:M,TRAVIS:M})),$e=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Be(){if(b("FORCE_COLOR")!==void 0)switch(b("FORCE_COLOR")){case"":case"1":case"true":return v;case"2":return M;case"3":return _;default:return V}if(b("NODE_DISABLE_COLORS")!==void 0&&b("NODE_DISABLE_COLORS")!==""||b("NO_COLOR")!==void 0&&b("NO_COLOR")!==""||b("TERM")==="dumb")return V;if(b("TMUX"))return _;if("TF_BUILD"in T&&"AGENT_NAME"in T)return v;if("CI"in T){for(const{0:e,1:t}of xe)if(e in T)return t;return b("CI_NAME")==="codeship"?M:V}if("TEAMCITY_VERSION"in T)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(b("TEAMCITY_VERSION"))!==null?v:V;switch(b("TERM_PROGRAM")){case"iTerm.app":return!b("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(b("TERM_PROGRAM_VERSION"))!==null?M:_;case"HyperTerm":case"MacTerm":return _;case"Apple_Terminal":return M}if(b("COLORTERM")==="truecolor"||b("COLORTERM")==="24bit")return _;if(b("TERM")){if(/truecolor/.exec(b("TERM"))!==null)return _;if(/^xterm-256/.exec(b("TERM"))!==null)return M;const e=b("TERM").toLowerCase();if(de[e])return de[e];if($e.some(t=>t.exec(e)!==null))return v}return b("COLORTERM")?v:V}const N={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},ce=["info","success","warn","error","debug"];function Fe(e,t){return ce.indexOf(t)<=ce.indexOf(e)}const qe={info:N.fg.blue,success:N.fg.green,warn:N.fg.yellow,error:N.fg.red,debug:N.fg.magenta},je=(e,t,r)=>{const n=new Date().toISOString();return r?`${N.dim}${n}${N.reset} ${qe[e]}${e.toUpperCase()}${N.reset} ${N.bright}[Better Auth]:${N.reset} ${t}`:`${n} ${e.toUpperCase()} [Better Auth]: ${t}`},ke=e=>{const t="error",r=Be()!==1,n=(s,c,i=[])=>{if(!Fe(t,s))return;const u=je(s,c,r);{s==="error"?console.error(u,...i):s==="warn"?console.warn(u,...i):console.log(u,...i);return}};return{...Object.fromEntries(ce.map(s=>[s,(...[c,...i])=>n(s,c,i)])),get level(){return t}}};ke();var H=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function De(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new H(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function ze(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new H(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof H?t:new H(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function re(e,t="/api/auth"){if(ze(e),De(e))return e;const r=e.replace(/\/+$/,"");return!t||t==="/"?r:(t=t.startsWith("/")?t:`/${t}`,`${r}${t}`)}function Ge(e,t,r,n,s){if(e)return re(e,t);{const c=T.BETTER_AUTH_URL||T.NEXT_PUBLIC_BETTER_AUTH_URL||T.PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_AUTH_URL||(T.BASE_URL!=="/"?T.BASE_URL:void 0);if(c)return re(c,t)}if(typeof window<"u"&&window.location)return re(window.location.origin,t)}const Ve={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},We=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,he={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},He=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function Je(e){return e instanceof Date&&!isNaN(e.getTime())}function Ye(e){const t=He.exec(e);if(!t)return null;const[,r,n,s,c,i,u,o,a,l,d]=t;let m=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(s,10),parseInt(c,10),parseInt(i,10),parseInt(u,10),o?parseInt(o.padEnd(3,"0"),10):0));if(a){const O=(parseInt(l,10)*60+parseInt(d,10))*(a==="+"?-1:1);m.setUTCMinutes(m.getUTCMinutes()+O)}return Je(m)?m:null}function Xe(e,t={}){const{strict:r=!1,warnings:n=!1,reviver:s,parseDates:c=!0}=t;if(typeof e!="string")return e;const i=e.trim();if(i.length>0&&i[0]==='"'&&i.endsWith('"')&&!i.slice(1,-1).includes('"'))return i.slice(1,-1);const u=i.toLowerCase();if(u.length<=9&&u in he)return he[u];if(!We.test(i)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Ve).some(([o,a])=>{const l=a.test(i);return l&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${o} pattern`),l})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(i,(a,l)=>{if(a==="__proto__"||a==="constructor"&&l&&typeof l=="object"&&"prototype"in l){n&&console.warn(`[better-json] Dropping "${a}" key to prevent prototype pollution`);return}if(c&&typeof l=="string"){const d=Ye(l);if(d)return d}return s?s(a,l):l})}catch(o){if(r)throw o;return e}}function Qe(e,t={strict:!0}){return Xe(e,t)}let L=[],F=0;const Y=4,D=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let c=F+Y;c<L.length;)L[c]===n?L.splice(c,Y):c+=Y;let s=t.indexOf(n);~s&&(t.splice(s,1),--r.lc||r.off())}},notify(n,s){let c=!L.length;for(let i of t)L.push(i,r.value,n,s);if(c){for(F=0;F<L.length;F+=Y)L[F](L[F+1],L[F+2],L[F+3]);L.length=0}},off(){},set(n){let s=r.value;s!==n&&(r.value=n,r.notify(s))},subscribe(n){let s=r.listen(n);return n(r.value),s},value:e};return r},Ze=5,X=6,Q=10;let Ke=(e,t,r,n)=>(e.events=e.events||{},e.events[r+Q]||(e.events[r+Q]=n(s=>{e.events[r].reduceRight((c,i)=>(i(c),c),{shared:{},...s})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let s=e.events[r],c=s.indexOf(t);s.splice(c,1),s.length||(delete e.events[r],e.events[r+Q](),delete e.events[r+Q])}),et=1e3,we=(e,t)=>Ke(e,n=>{let s=t(n);s&&e.events[X].push(s)},Ze,n=>{let s=e.listen;e.listen=(...i)=>(!e.lc&&!e.active&&(e.active=!0,n()),s(...i));let c=e.off;return e.events[X]=[],e.off=()=>{c(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let i of e.events[X])i();e.events[X]=[]}},et)},()=>{e.listen=s,e.off=c}});function tt(e,t,r){let n=new Set(t).add(void 0);return e.listen((s,c,i)=>{n.has(i)&&r(s,c,i)})}var rt=Object.defineProperty,nt=Object.defineProperties,st=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,it=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,ge=(e,t,r)=>t in e?rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))it.call(t,r)&&ge(e,r,t[r]);if(me)for(var r of me(t))ot.call(t,r)&&ge(e,r,t[r]);return e},C=(e,t)=>nt(e,st(t)),at=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},ct=async(e,t)=>{var r,n,s,c,i,u;let o=t||{};const a={onRequest:[t==null?void 0:t.onRequest],onResponse:[t==null?void 0:t.onResponse],onSuccess:[t==null?void 0:t.onSuccess],onError:[t==null?void 0:t.onError],onRetry:[t==null?void 0:t.onRetry]};if(!t||!(t!=null&&t.plugins))return{url:e,options:o,hooks:a};for(const l of(t==null?void 0:t.plugins)||[]){if(l.init){const d=await((r=l.init)==null?void 0:r.call(l,e.toString(),t));o=d.options||o,e=d.url}a.onRequest.push((n=l.hooks)==null?void 0:n.onRequest),a.onResponse.push((s=l.hooks)==null?void 0:s.onResponse),a.onSuccess.push((c=l.hooks)==null?void 0:c.onSuccess),a.onError.push((i=l.hooks)==null?void 0:i.onError),a.onRetry.push((u=l.hooks)==null?void 0:u.onRetry)}return{url:e,options:o,hooks:a}},ye=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},lt=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function ut(e){if(typeof e=="number")return new ye({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new ye(e);case"exponential":return new lt(e);default:throw new Error("Invalid retry strategy")}}var ft=async e=>{const t={},r=async n=>typeof n=="function"?await n():n;if(e!=null&&e.auth){if(e.auth.type==="Bearer"){const n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const n=r(e.auth.username),s=r(e.auth.password);if(!n||!s)return t;t.authorization=`Basic ${btoa(`${n}:${s}`)}`}else if(e.auth.type==="Custom"){const n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},dt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function ht(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return dt.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function mt(e){try{return JSON.parse(e),!0}catch{return!1}}function Re(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function pe(e){try{return JSON.parse(e)}catch{return e}}function be(e){return typeof e=="function"}function gt(e){if(e!=null&&e.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&be(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&be(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function yt(e){const t=new Headers(e==null?void 0:e.headers),r=await ft(e);for(const[n,s]of Object.entries(r||{}))t.set(n,s);if(!t.has("content-type")){const n=pt(e==null?void 0:e.body);n&&t.set("content-type",n)}return t}function pt(e){return Re(e)?"application/json":null}function bt(e){if(!(e!=null&&e.body))return null;const t=new Headers(e==null?void 0:e.headers);if(Re(e.body)&&!t.has("content-type")){for(const[r,n]of Object.entries(e==null?void 0:e.body))n instanceof Date&&(e.body[r]=n.toISOString());return JSON.stringify(e.body)}return e.body}function vt(e,t){var r;if(t!=null&&t.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return _e.includes(n)?n.toUpperCase():t!=null&&t.body?"POST":"GET"}return t!=null&&t.body?"POST":"GET"}function wt(e,t){let r;return!(e!=null&&e.signal)&&(e!=null&&e.timeout)&&(r=setTimeout(()=>t==null?void 0:t.abort(),e==null?void 0:e.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var Rt=class Oe extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,Oe.prototype)}};async function K(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new Rt(r.issues);return r.value}var _e=["get","post","put","patch","delete"],Ot=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,s,c,i;const u=((s=(n=e.plugins)==null?void 0:n.find(o=>{var a;return(a=o.schema)!=null&&a.config?t.startsWith(o.schema.config.baseURL||"")||t.startsWith(o.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(u){let o=t;(c=u.config)!=null&&c.prefix&&o.startsWith(u.config.prefix)&&(o=o.replace(u.config.prefix,""),u.config.baseURL&&(t=t.replace(u.config.prefix,u.config.baseURL))),(i=u.config)!=null&&i.baseURL&&o.startsWith(u.config.baseURL)&&(o=o.replace(u.config.baseURL,""));const a=u.schema[o];if(a){let l=C(I({},r),{method:a.method,output:a.output});return r!=null&&r.disableValidation||(l=C(I({},l),{body:a.input?await K(a.input,r==null?void 0:r.body):r==null?void 0:r.body,params:a.params?await K(a.params,r==null?void 0:r.params):r==null?void 0:r.params,query:a.query?await K(a.query,r==null?void 0:r.query):r==null?void 0:r.query})),{url:t,options:l}}}return{url:t,options:r}}}),_t=e=>{async function t(r,n){const s=C(I(I({},e),n),{plugins:[...(e==null?void 0:e.plugins)||[],Ot(e||{})]});if(e!=null&&e.catchAllError)try{return await le(r,s)}catch(c){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:c}}}return await le(r,s)}return t};function St(e,t){let{baseURL:r,params:n,query:s}=t||{query:{},params:{},baseURL:""},c=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const d=e.toString().split("@")[1].split("/")[0];_e.includes(d)&&(e=e.replace(`@${d}/`,"/"))}c.endsWith("/")||(c+="/");let[i,u]=e.replace(c,"").split("?");const o=new URLSearchParams(u);for(const[d,m]of Object.entries(s||{}))m!=null&&o.set(d,String(m));if(n)if(Array.isArray(n)){const d=i.split("/").filter(m=>m.startsWith(":"));for(const[m,O]of d.entries()){const R=n[m];i=i.replace(O,R)}}else for(const[d,m]of Object.entries(n))i=i.replace(`:${d}`,String(m));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let a=o.toString();return a=a.length>0?`?${a}`.replace(/\+/g,"%20"):"",c.startsWith("http")?new URL(`${i}${a}`,c):`${c}${i}${a}`}var le=async(e,t)=>{var r,n,s,c,i,u,o,a;const{hooks:l,url:d,options:m}=await ct(e,t),O=gt(m),R=new AbortController,A=(r=m.signal)!=null?r:R.signal,p=St(d,m),B=bt(m),P=await yt(m),S=vt(d,m);let y=C(I({},m),{url:p,headers:P,body:B,method:S,signal:A});for(const E of l.onRequest)if(E){const w=await E(y);w instanceof Object&&(y=w)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((n=t==null?void 0:t.body)==null?void 0:n.pipe)=="function")&&("duplex"in y||(y.duplex="half"));const{clearTimeout:g}=wt(m,R);let f=await O(y.url,y);g();const U={response:f,request:y};for(const E of l.onResponse)if(E){const w=await E(C(I({},U),{response:(s=t==null?void 0:t.hookOptions)!=null&&s.cloneResponse?f.clone():f}));w instanceof Response?f=w:w instanceof Object&&(f=w.response)}if(f.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};const w=ht(f),x={data:"",response:f,request:y};if(w==="json"||w==="text"){const $=await f.text(),Ue=await((c=y.jsonParser)!=null?c:pe)($);x.data=Ue}else x.data=await f[w]();y!=null&&y.output&&y.output&&!y.disableValidation&&(x.data=await K(y.output,x.data));for(const $ of l.onSuccess)$&&await $(C(I({},x),{response:(i=t==null?void 0:t.hookOptions)!=null&&i.cloneResponse?f.clone():f}));return t!=null&&t.throw?x.data:{data:x.data,error:null}}const J=(u=t==null?void 0:t.jsonParser)!=null?u:pe,q=await f.text(),z=mt(q),h=z?await J(q):null,ee={response:f,responseText:q,request:y,error:C(I({},h),{status:f.status,statusText:f.statusText})};for(const E of l.onError)E&&await E(C(I({},ee),{response:(o=t==null?void 0:t.hookOptions)!=null&&o.cloneResponse?f.clone():f}));if(t!=null&&t.retry){const E=ut(t.retry),w=(a=t.retryAttempt)!=null?a:0;if(await E.shouldAttemptRetry(w,f)){for(const $ of l.onRetry)$&&await $(U);const x=E.getDelay(w);return await new Promise($=>setTimeout($,x)),await le(e,C(I({},t),{retryAttempt:w+1}))}}if(t!=null&&t.throw)throw new at(f.status,f.statusText,z?h:q);return{data:null,error:C(I({},h),{status:f.status,statusText:f.statusText})}};const ne=Symbol.for("better-auth:broadcast-channel"),Et=()=>Math.floor(Date.now()/1e3);var Tt=class{constructor(e="better-auth.message"){j(this,"listeners",new Set);j(this,"name");this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:Et()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const r=JSON.parse(t.newValue??"{}");(r==null?void 0:r.event)!=="session"||!(r!=null&&r.data)||this.listeners.forEach(n=>n(r))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function se(e="better-auth.message"){return globalThis[ne]||(globalThis[ne]=new Tt(e)),globalThis[ne]}const ie=Symbol.for("better-auth:focus-manager");var At=class{constructor(){j(this,"listeners",new Set)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function ve(){return globalThis[ie]||(globalThis[ie]=new At),globalThis[ie]}const oe=Symbol.for("better-auth:online-manager");var Pt=class{constructor(){j(this,"listeners",new Set);j(this,"isOnline",typeof navigator<"u"?navigator.onLine:!0)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function ae(){return globalThis[oe]||(globalThis[oe]=new Pt),globalThis[oe]}const Lt=()=>typeof window>"u",W=(e,t,r,n)=>{const s=D({data:null,error:null,isPending:!0,isRefetching:!1,refetch:u=>c(u)}),c=async u=>new Promise(o=>{const a=typeof n=="function"?n({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):n;r(t,{...a,query:{...a==null?void 0:a.query,...u==null?void 0:u.query},async onSuccess(l){var d;s.set({data:l.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await((d=a==null?void 0:a.onSuccess)==null?void 0:d.call(a,l))},async onError(l){var R,A;const{request:d}=l,m=typeof d.retry=="number"?d.retry:(R=d.retry)==null?void 0:R.attempts,O=d.retryAttempt||0;m&&O<m||(s.set({error:l.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await((A=a==null?void 0:a.onError)==null?void 0:A.call(a,l)))},async onRequest(l){var m;const d=s.get();s.set({isPending:d.data===null,data:d.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await((m=a==null?void 0:a.onRequest)==null?void 0:m.call(a,l))}}).catch(l=>{s.set({error:l,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{o(void 0)})});e=Array.isArray(e)?e:[e];let i=!1;for(const u of e)u.subscribe(async()=>{Lt()||(i?await c():we(s,()=>{const o=setTimeout(async()=>{i||(await c(),i=!0)},0);return()=>{s.off(),u.off(),clearTimeout(o)}}))});return s},k=()=>Math.floor(Date.now()/1e3),It=5;function Ut(e){var P,S,y;const{sessionAtom:t,sessionSignal:r,$fetch:n,options:s={}}=e,c=((P=s.sessionOptions)==null?void 0:P.refetchInterval)??0,i=((S=s.sessionOptions)==null?void 0:S.refetchOnWindowFocus)??!0,u=((y=s.sessionOptions)==null?void 0:y.refetchWhenOffline)??!1,o={lastSync:0,lastSessionRequest:0,cachedSession:void 0},a=()=>u||ae().isOnline,l=g=>{if(!a())return;if((g==null?void 0:g.event)==="storage"){o.lastSync=k(),r.set(!r.get());return}const f=t.get();if((g==null?void 0:g.event)==="poll"){o.lastSessionRequest=k(),n("/get-session").then(U=>{t.set({...f,data:U.data,error:U.error||null}),o.lastSync=k(),r.set(!r.get())}).catch(()=>{});return}(g==null?void 0:g.event)==="visibilitychange"&&k()-o.lastSessionRequest<It&&(f==null?void 0:f.data)!==null&&(f==null?void 0:f.data)!==void 0||((f==null?void 0:f.data)===null||(f==null?void 0:f.data)===void 0||(g==null?void 0:g.event)==="visibilitychange")&&((g==null?void 0:g.event)==="visibilitychange"&&(o.lastSessionRequest=k()),o.lastSync=k(),r.set(!r.get()))},d=g=>{se().post({event:"session",data:{trigger:g},clientId:Math.random().toString(36).substring(7)})},m=()=>{c&&c>0&&(o.pollInterval=setInterval(()=>{var g;(g=t.get())!=null&&g.data&&l({event:"poll"})},c*1e3))},O=()=>{o.unsubscribeBroadcast=se().subscribe(()=>{l({event:"storage"})})},R=()=>{i&&(o.unsubscribeFocus=ve().subscribe(()=>{l({event:"visibilitychange"})}))},A=()=>{o.unsubscribeOnline=ae().subscribe(g=>{g&&l({event:"visibilitychange"})})};return{init:()=>{m(),O(),R(),A(),se().setup(),ve().setup(),ae().setup()},cleanup:()=>{o.pollInterval&&(clearInterval(o.pollInterval),o.pollInterval=void 0),o.unsubscribeBroadcast&&(o.unsubscribeBroadcast(),o.unsubscribeBroadcast=void 0),o.unsubscribeFocus&&(o.unsubscribeFocus(),o.unsubscribeFocus=void 0),o.unsubscribeOnline&&(o.unsubscribeOnline(),o.unsubscribeOnline=void 0),o.lastSync=0,o.lastSessionRequest=0,o.cachedSession=void 0},triggerRefetch:l,broadcastSessionUpdate:d}}const Ct={id:"redirect",name:"Redirect",hooks:{onSuccess(e){var t,r;if((t=e.data)!=null&&t.url&&((r=e.data)!=null&&r.redirect)&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},Mt={id:"user-agent",name:"UserAgent",hooks:{onRequest(e){e.headers.append("user-agent","better-auth")}}};function Nt(e,t){const r=D(!1),n=W(r,"/get-session",e,{method:"GET"});return we(n,()=>{const s=Ut({sessionAtom:n,sessionSignal:r,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:n,$sessionSignal:r}}const xt=(e,t)=>{var y,g,f,U,J,q,z;const r="credentials"in Request.prototype,n=Ge(e==null?void 0:e.baseURL,e==null?void 0:e.basePath)??"/api/auth",s=((y=e==null?void 0:e.plugins)==null?void 0:y.flatMap(h=>h.fetchPlugins).filter(h=>h!==void 0))||[],c={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:(g=e==null?void 0:e.fetchOptions)==null?void 0:g.onSuccess,onError:(f=e==null?void 0:e.fetchOptions)==null?void 0:f.onError,onRequest:(U=e==null?void 0:e.fetchOptions)==null?void 0:U.onRequest,onResponse:(J=e==null?void 0:e.fetchOptions)==null?void 0:J.onResponse}},{onSuccess:i,onError:u,onRequest:o,onResponse:a,...l}=(e==null?void 0:e.fetchOptions)||{},d=_t({baseURL:n,...r?{credentials:"include"}:{},method:"GET",jsonParser(h){return h?Qe(h,{strict:!1}):null},customFetchImpl:fetch,...l,plugins:[c,...l.plugins||[],...e!=null&&e.disableDefaultFetchPlugins?[]:[Mt,Ct],...s]}),{$sessionSignal:m,session:O}=Nt(d,e),R=(e==null?void 0:e.plugins)||[];let A={},p={$sessionSignal:m,session:O},B={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const P=[{signal:"$sessionSignal",matcher(h){return h==="/sign-out"||h==="/update-user"||h==="/sign-up/email"||h==="/sign-in/email"||h==="/delete-user"||h==="/verify-email"||h==="/revoke-sessions"||h==="/revoke-session"||h==="/change-email"}}];for(const h of R)h.getAtoms&&Object.assign(p,(q=h.getAtoms)==null?void 0:q.call(h,d)),h.pathMethods&&Object.assign(B,h.pathMethods),h.atomListeners&&P.push(...h.atomListeners);const S={notify:h=>{p[h].set(!p[h].get())},listen:(h,ee)=>{p[h].subscribe(ee)},atoms:p};for(const h of R)h.getActions&&Object.assign(A,(z=h.getActions)==null?void 0:z.call(h,d,S,e));return{get baseURL(){return n},pluginsActions:A,pluginsAtoms:p,pluginPathMethods:B,atomListeners:P,$fetch:d,$store:S}};function $t(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function Bt(e,t,r){const n=t[e],{fetchOptions:s,query:c,...i}=r||{};return n||(s!=null&&s.method?s.method:i&&Object.keys(i).length>0?"POST":"GET")}function Ft(e,t,r,n,s){function c(i=[]){return new Proxy(function(){},{get(u,o){if(typeof o!="string"||o==="then"||o==="catch"||o==="finally")return;const a=[...i,o];let l=e;for(const d of a)if(l&&typeof l=="object"&&d in l)l=l[d];else{l=void 0;break}return typeof l=="function"||$t(l)?l:c(a)},apply:async(u,o,a)=>{const l="/"+i.map(P=>P.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),d=a[0]||{},m=a[1]||{},{query:O,fetchOptions:R,...A}=d,p={...m,...R},B=Bt(l,r,d);return await t(l,{...p,body:B==="GET"?void 0:{...A,...(p==null?void 0:p.body)||{}},query:O||(p==null?void 0:p.query),method:B,async onSuccess(P){var y;if(await((y=p==null?void 0:p.onSuccess)==null?void 0:y.call(p,P)),!s||p.disableSignal)return;const S=s.filter(g=>g.matcher(l));if(S.length)for(const g of S){const f=n[g.signal];if(!f)return;const U=f.get();setTimeout(()=>{f.set(!U)},10)}}})}})}return c()}function qt(e,t={}){let r=te.useRef(e.get());const{keys:n,deps:s=[e,n]}=t;let c=te.useCallback(u=>{const o=a=>{r.current!==a&&(r.current=a,u())};return o(e.value),n!=null&&n.length?tt(e,n,o):e.listen(o)},s),i=()=>r.current;return te.useSyncExternalStore(c,i,i)}function jt(e){return`use${kt(e)}`}function kt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Dt(e){const{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:s,$store:c,atomListeners:i}=xt(e);let u={};for(const[o,a]of Object.entries(n))u[jt(o)]=()=>qt(a);return Ft({...r,...u,$fetch:s,$store:c},s,t,n,i)}function zt(e){return{authorize(t,r="AND"){let n=!1;for(const[s,c]of Object.entries(t)){const i=e[s];if(!i)return{success:!1,error:`You are not allowed to access resource: ${s}`};if(Array.isArray(c))n=c.every(u=>i.includes(u));else if(typeof c=="object"){const u=c;u.connector==="OR"?n=u.actions.some(o=>i.includes(o)):n=u.actions.every(o=>i.includes(o))}else throw new H("Invalid access control request");if(n&&r==="OR")return{success:n};if(!n&&r==="AND")return{success:!1,error:`unauthorized to access resource "${s}"`}}return n?{success:n}:{success:!1,error:"Not authorized"}},statements:e}}function Se(e){return{newRole(t){return zt(t)},statements:e}}const Gt={user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]},Ee=Se(Gt),Te=Ee.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),Ae=Ee.newRole({user:[],session:[]}),Vt={admin:Te,user:Ae},Wt=e=>{var n,s,c,i,u,o;if(e.userId&&((s=(n=e.options)==null?void 0:n.adminUserIds)!=null&&s.includes(e.userId)))return!0;if(!e.permissions&&!e.permission)return!1;const t=(e.role||((c=e.options)==null?void 0:c.defaultRole)||"user").split(","),r=((i=e.options)==null?void 0:i.roles)||Vt;for(const a of t)if((o=(u=r[a])==null?void 0:u.authorize(e.permission??e.permissions))!=null&&o.success)return!0;return!1},Ht={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]},ue=Se(Ht),Pe=ue.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"],ac:["create","read","update","delete"]}),Le=ue.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]}),Ie=ue.newRole({organization:[],member:[],invitation:[],team:[],ac:["read"]}),Jt={admin:Pe,owner:Le,member:Ie},Yt=(e,t)=>{var i,u;if(!e.permissions&&!e.permission)return!1;const r=e.role.split(","),n=e.options.creatorRole||"owner",s=r.includes(n),c=e.allowCreatorAllPermissions||!1;if(s&&c)return!0;for(const o of r)if((u=(i=t[o])==null?void 0:i.authorize(e.permissions??e.permission))!=null&&u.success)return!0;return!1},Xt=e=>{const t={admin:Te,user:Ae,...e==null?void 0:e.roles};return{id:"admin-client",$InferServerPlugin:{},getActions:()=>({admin:{checkRolePermission:r=>Wt({role:r.role,options:{ac:e==null?void 0:e.ac,roles:t},permissions:r.permissions??r.permission})}}),pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}}},Qt=e=>Yt(e,e.options.roles||Jt),Zt=e=>{const t=D(!1),r=D(!1),n=D(!1),s=D(!1),c={admin:Pe,member:Ie,owner:Le,...e==null?void 0:e.roles};return{id:"organization",$InferServerPlugin:{},getActions:(i,u,o)=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{},Team:{}},organization:{checkRolePermission:a=>Qt({role:a.role,options:{ac:e==null?void 0:e.ac,roles:c},permissions:a.permissions??a.permission})}}),getAtoms:i=>{const u=W(t,"/organization/list",i,{method:"GET"});return{$listOrg:t,$activeOrgSignal:r,$activeMemberSignal:n,$activeMemberRoleSignal:s,activeOrganization:W([r],"/organization/get-full-organization",i,()=>({method:"GET"})),listOrganizations:u,activeMember:W([n],"/organization/get-active-member",i,{method:"GET"}),activeMemberRole:W([s],"/organization/get-active-member-role",i,{method:"GET"})}},pathMethods:{"/organization/get-full-organization":"GET","/organization/list-user-teams":"GET"},atomListeners:[{matcher(i){return i==="/organization/create"||i==="/organization/delete"||i==="/organization/update"},signal:"$listOrg"},{matcher(i){return i.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(i){return i.startsWith("/organization/set-active")},signal:"$sessionSignal"},{matcher(i){return i.includes("/organization/update-member-role")},signal:"$activeMemberSignal"},{matcher(i){return i.includes("/organization/update-member-role")},signal:"$activeMemberRoleSignal"}]}},Kt=()=>({id:"phoneNumber",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/phone-number/update"||e==="/phone-number/verify"||e==="/sign-in/phone-number"},signal:"$sessionSignal"}]});function er(){return console.log("[AUTH] Using VITE_API_URL:","https://api.yourdomain.com"),"https://api.yourdomain.com"}const tr=Dt({baseURL:er(),plugins:[Xt(),Zt(),Kt()]}),ir=Object.freeze(Object.defineProperty({__proto__:null,authClient:tr},Symbol.toStringTag,{value:"Module"}));export{tr as a,ir as b};
