import{a as D,w as H,u as W,L as z}from"./chunk-JZWAC4HX-DumfKpwM.js";import{r as p,j as e}from"./forgot-password-Cd1Knve9.js";import{u as $}from"./useDateFormatter-CNVcwzUI.js";import{V as a,m as k}from"./types-DFYgxmzW.js";import{u as K}from"./AppContext-CqFrqiNi.js";import{T as X,a as q,b as C,c as g,d as G,e as u}from"./table-B8EXJzV4.js";import{B as J}from"./badge-OnEQOSZY.js";import{B as w}from"./button-D5icbzZz.js";import{I as Q}from"./input-emgR2opu.js";import{C as Y}from"./card-Cg68uFrF.js";import{T as I,a as A,b as c}from"./tabs-C5PlI2Of.js";import{c as b}from"./utils-CDN07tui.js";import{P as Z}from"./PageHeader-BWRrOg2b.js";import{D as v}from"./DashboardCard-CAo4eudV.js";import{L as ee}from"./ListFilterSection-C2yv81r0.js";import{D as se,a as ae,b as te,e as re,c as S,d as le}from"./dropdown-menu-CNNo2K3q.js";import{D as oe,a as ne,b as ie,c as ce,d as de,e as me}from"./dialog-GXWVtUJA.js";import{E as xe}from"./ellipsis-DBh4irOy.js";import{E as ue}from"./eye-D6sHawNO.js";import{S as pe}from"./square-pen-DbBn1E1l.js";import{T as he}from"./trash-2-BO5CKzGP.js";import{T as fe}from"./triangle-alert-ChAdqAq2.js";import{L as ge}from"./loader-circle-ic6ikmbW.js";import{B as T}from"./bus-D0L2JeBO.js";import{P as be}from"./plus-D5F9e-Lx.js";import{C as M}from"./circle-check-big-I14bXISs.js";import{T as O}from"./trending-up-BKzFUhqw.js";import{W as V}from"./wrench-sIQVKmUa.js";import{S as Ne}from"./search-CnuVL9vz.js";import{I as je}from"./inbox-DZlonFmr.js";import{T as ve}from"./truck-DjqGUVW-.js";import"./pt-BR-Dxhrr4Mm.js";import"./format-Teop82l3.js";import"./reset-password-P0kMDf4s.js";import"./index-Ds5WWjjE.js";import"./index-CGIZjBuz.js";import"./index-CNk52wy-.js";import"./index-CzPzUr9r.js";import"./index-r0Cach5g.js";import"./index-BTyV9z74.js";import"./createLucideIcon-C45Xejds.js";import"./Combination-Bzd-zPU3.js";import"./index-BDGasEjq.js";import"./chevron-right-DQu5sotq.js";import"./check-DPa0jV58.js";import"./circle-Inv2uPuq.js";import"./index-BCt1EX5H.js";import"./x-CitWcJvG.js";const L=p.forwardRef(({className:t,value:r,...l},o)=>e.jsx("div",{ref:o,className:b("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",t),...l,children:e.jsx("div",{className:"h-full w-full flex-1 bg-primary transition-all duration-300",style:{transform:`translateX(-${100-(r||0)}%)`}})}));L.displayName="Progress";const we=({veiculo:t,onUpdate:r})=>{const l=D(),[o,d]=p.useState(!1),[i,N]=p.useState(!1),m=async()=>{N(!0);try{if(!(await fetch(`/admin/fleet?intent=delete&id=${t.id}`,{method:"POST"})).ok)throw new Error("Failed to delete vehicle");r&&r()}catch(j){console.error("Erro ao excluir veículo:",j),alert("Erro ao excluir veículo. Por favor, tente novamente.")}finally{N(!1),d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(w,{variant:"ghost",className:"h-10 w-10 p-0 rounded-xl hover:bg-primary/10 hover:text-primary transition-colors",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(xe,{className:"h-5 w-5",strokeWidth:2.5})]})}),e.jsxs(te,{align:"end",className:"w-56 p-2 rounded-2xl shadow-2xl border-none bg-card/95 backdrop-blur-md",children:[e.jsx(re,{className:"text-[12px] font-black uppercase tracking-widest text-muted-foreground px-3 py-2",children:"Operações"}),e.jsxs(S,{onClick:()=>l(`/admin/fleet/${t.id}`),className:"rounded-xl px-3 py-2.5 font-bold focus:bg-primary focus:text-primary-foreground gap-3",children:[e.jsx(ue,{className:"h-4 w-4"}),"Ver Detalhes"]}),e.jsxs(S,{onClick:()=>l(`/admin/fleet/edit/${t.id}`),className:"rounded-xl px-3 py-2.5 font-bold focus:bg-primary focus:text-primary-foreground gap-3",children:[e.jsx(pe,{className:"h-4 w-4"}),"Editar Veículo"]}),e.jsx(le,{className:"bg-border/50 my-2"}),e.jsxs(S,{onClick:()=>d(!0),className:"rounded-xl px-3 py-2.5 font-bold text-destructive focus:bg-destructive focus:text-destructive-foreground gap-3",children:[e.jsx(he,{className:"h-4 w-4"}),"Excluir Registro"]})]})]}),e.jsx(oe,{open:o,onOpenChange:d,children:e.jsxs(ne,{className:"rounded-[2rem] border-none shadow-2xl max-w-sm p-8 bg-card/95 backdrop-blur-md",children:[e.jsxs(ie,{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center",children:e.jsx(fe,{className:"h-8 w-8 text-destructive",strokeWidth:2.5})}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(ce,{className:"text-2xl font-black tracking-tight",children:"Confirmar Exclusão"}),e.jsxs(de,{className:"font-medium text-muted-foreground leading-relaxed",children:["Você tem certeza que deseja excluir o veículo ",e.jsx("span",{className:"text-foreground font-black tracking-tight",children:t.placa}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-xs uppercase font-black tracking-widest opacity-50",children:"Esta ação é irreversível"})]})]})]}),e.jsxs(me,{className:"mt-8 flex-col sm:flex-col gap-3",children:[e.jsx(w,{variant:"destructive",onClick:m,disabled:i,className:"w-full h-12 rounded-2xl font-black tracking-tighter text-base shadow-lg shadow-destructive/20 active:scale-95 transition-all",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"mr-2 h-5 w-5 animate-spin"}),"EXCLUINDO..."]}):"EXCLUIR DEFINITIVAMENTE"}),e.jsx(w,{variant:"ghost",onClick:()=>d(!1),disabled:i,className:"w-full h-12 rounded-2xl font-black tracking-tighter text-muted-foreground hover:bg-muted/50 transition-all",children:"CANCELAR"})]})]})})]})},Te=({status:t})=>{const r={[a.ACTIVE]:{label:k[a.ACTIVE],icon:M,className:"bg-emerald-500/10 text-emerald-600 border-emerald-500/20"},[a.MAINTENANCE]:{label:k[a.MAINTENANCE],icon:V,className:"bg-amber-500/10 text-amber-600 border-amber-500/20"},[a.IN_TRANSIT]:{label:k[a.IN_TRANSIT],icon:O,className:"bg-blue-500/10 text-blue-600 border-blue-500/20"}},l=r[t]||r[a.ACTIVE],o=l.icon||T;return e.jsxs(J,{variant:"outline",className:b("gap-1.5 font-bold px-2 py-0.5 rounded-xl",l.className),children:[e.jsx(o,{size:12,strokeWidth:2.5}),l.label]})},Ns=H(function(){const{vehicles:r}=W(),{currentContext:l}=K();$();const[o,d]=p.useState("TODOS"),[i,N]=p.useState("TODOS"),[m,j]=p.useState(""),B=D(),h=r,E=h.filter(s=>{const n=o==="TODOS"||s.status===o,x=i==="TODOS"||s.tipo===i,f=m===""||(s.placa||"").toLowerCase().includes(m.toLowerCase())||(s.modelo||"").toLowerCase().includes(m.toLowerCase());return n&&x&&f}),F=h.length,P=h.filter(s=>s.status===a.ACTIVE).length,R=h.filter(s=>s.status===a.IN_TRANSIT).length,_=h.filter(s=>s.status===a.MAINTENANCE).length,U=(s,n)=>{if(!n)return 0;const f=100-(n-(s||0))/1e4*100;return Math.min(Math.max(f,0),100)};return e.jsxs("div",{className:"p-8 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700 pb-10",children:[e.jsx(Z,{title:"Gestão de Frota",subtitle:"Controle operacional e manutenção preventiva",icon:T,rightElement:e.jsx(w,{asChild:!0,className:"h-14 px-6 rounded-xl font-semibold shadow-lg shadow-primary/20",children:e.jsxs(z,{to:"/admin/fleet/new",children:[e.jsx(be,{size:20,className:"mr-2",strokeWidth:3}),"NOVA VEÍCULO"]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(v,{title:"Total de Veículos",value:F,icon:T,variant:"primary"}),e.jsx(v,{title:"Frotas Ativas",value:P,icon:M,variant:"emerald"}),e.jsx(v,{title:"Em Operação",value:R,icon:O,variant:"blue"}),e.jsx(v,{title:"Manutenção",value:_,icon:V,variant:"amber"})]}),e.jsxs(ee,{gridClassName:"lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1.5 flex flex-col",children:[e.jsx("label",{className:"text-label-caps ml-1",children:"Buscar Veículo"}),e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(Ne,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(Q,{placeholder:"Placa ou modelo...",value:m,onChange:s=>j(s.target.value),className:"pl-11 h-14 bg-muted/40 border-input rounded-xl font-bold transition-all focus-visible:ring-2 focus-visible:ring-primary/20"})]})]}),e.jsxs("div",{className:"space-y-1.5 flex flex-col",children:[e.jsx("label",{className:"text-label-caps ml-1",children:"Status Operacional"}),e.jsx(I,{value:o,onValueChange:d,className:"w-full",children:e.jsxs(A,{className:"bg-muted/40 p-1.5 rounded-xl h-14 flex w-full border border-border/50",children:[e.jsx(c,{value:"TODOS",className:"flex-1 rounded-xl font-black text-[10px] tracking-widest",children:"TODOS"}),e.jsx(c,{value:a.ACTIVE,className:"flex-1 rounded-xl font-black text-[10px] tracking-widest",children:"ATIVOS"}),e.jsx(c,{value:a.IN_TRANSIT,className:"flex-1 rounded-xl font-black text-[10px] tracking-widest",children:"VIAGEM"}),e.jsx(c,{value:a.MAINTENANCE,className:"flex-1 rounded-xl font-black text-[10px] tracking-widest text-amber-600",children:"MANUT."})]})})]}),e.jsxs("div",{className:"space-y-1.5 flex flex-col",children:[e.jsx("label",{className:"text-label-caps ml-1",children:"Categoria"}),e.jsx(I,{value:i,onValueChange:N,className:"w-full",children:e.jsxs(A,{className:"bg-muted/40 p-1.5 rounded-xl h-14 flex w-full border border-border/50",children:[e.jsx(c,{value:"TODOS",className:"flex-1 rounded-xl font-black text-[10px] tracking-widest",children:"TODOS"}),e.jsx(c,{value:"ONIBUS",className:"flex-1 rounded-xl font-black text-[10px] tracking-widest",children:"ÔNIBUS"}),e.jsx(c,{value:"CAMINHAO",className:"flex-1 rounded-xl font-black text-[10px] tracking-widest",children:"CAMINHÕES"})]})})]})]}),e.jsx(Y,{className:"border-none shadow-2xl shadow-muted/20 overflow-hidden rounded-3xl bg-card/50 backdrop-blur-sm",children:e.jsxs(X,{children:[e.jsx(q,{className:"bg-muted/30",children:e.jsxs(C,{className:"hover:bg-transparent border-border/50",children:[e.jsx(g,{className:"pl-8 h-14 text-table-head",children:"Veículo"}),e.jsx(g,{className:"h-14 text-table-head text-center",children:"Tipo"}),e.jsx(g,{className:"h-14 text-table-head",children:"Status"}),e.jsx(g,{className:"h-14 text-table-head",children:"KMs & Revisão"}),e.jsx(g,{className:"h-14 text-table-head text-right",children:"Ações"})]})}),e.jsx(G,{children:E.length===0?e.jsx(C,{children:e.jsxs(u,{colSpan:6,className:"h-64 text-center",children:[e.jsx(je,{className:"w-12 h-14 mx-auto text-muted-foreground/30"}),e.jsx("p",{className:"font-bold text-sm text-muted-foreground",children:"Nenhum veículo encontrado"})]})}):E.map(s=>{const n=Number(s.km_atual||0),x=Number(s.proxima_revisao_km||0),f=U(n,x),y=x-n<=5e3;return e.jsxs(C,{className:"group hover:bg-muted/20 border-border/30 transition-colors",children:[e.jsx(u,{className:"pl-8 py-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:b("w-12 h-14 rounded-xl flex items-center justify-center text-white shadow-lg transition-transform group-hover:scale-110",s.tipo==="ONIBUS"?"bg-gradient-to-br from-blue-500 to-purple-600":"bg-gradient-to-br from-orange-500 to-red-600 shadow-orange-500/20"),children:s.tipo==="ONIBUS"?e.jsx(T,{size:22}):e.jsx(ve,{size:22})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm tracking-tight text-foreground",children:s.placa}),e.jsx("span",{className:"text-[11px] font-bold text-muted-foreground/80",children:s.modelo})]})]})}),e.jsx(u,{className:"text-center font-bold text-xs uppercase tracking-widest",children:s.tipo}),e.jsx(u,{children:e.jsx(Te,{status:s.status})}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col gap-2 w-48",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("span",{className:"text-sm font-semibold tracking-tight",children:[n.toLocaleString()," KM"]}),e.jsxs("span",{className:b("text-xs font-semibold",y?"text-orange-500":"text-muted-foreground"),children:[x.toLocaleString()," KM"]})]}),e.jsx(L,{value:f,className:b("h-1.5",y?"bg-orange-500/10 [&>div]:bg-orange-500":"bg-emerald-500/10 [&>div]:bg-emerald-500")})]})}),e.jsx(u,{className:"text-right pr-8",children:e.jsx(we,{veiculo:s,onUpdate:()=>B(".",{replace:!0})})})]},s.id)})})]})})]},"fleet-main")});export{Ns as default};
