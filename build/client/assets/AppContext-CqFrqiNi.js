import{r as i,j as P}from"./forgot-password-Cd1Knve9.js";import{E as r}from"./types-DFYgxmzW.js";import{a as n}from"./reset-password-P0kMDf4s.js";const T={[r.TURISMO]:{id:"emp-01",nome_fantasia:"JJê Turismo",tipo:r.TURISMO,cor_primaria:"blue"},[r.EXPRESS]:{id:"emp-02",nome_fantasia:"JJê Express",tipo:r.EXPRESS,cor_primaria:"orange"}},O=i.createContext(void 0),_=({children:s})=>{var S,h,E,v,w;const[d,u]=i.useState(r.TURISMO),[g,b]=i.useState(!0),[c,y]=i.useState(()=>typeof window<"u"&&localStorage.getItem("theme")||"light"),[C,z]=i.useState({}),{data:e}=n.useSession(),f=async()=>{try{const{data:t}=await n.getSession(),o=t==null?void 0:t.session.activeOrganizationId,a=o?`https://api.yourdomain.com/api/public/parameters?organizationId=${o}`:"https://api.yourdomain.com/api/public/parameters",x=await fetch(a);let m={};if(x.ok&&(await x.json()).forEach(p=>{m[p.key]=p.value}),o){const l=await fetch(`https://api.yourdomain.com/api/organization/${o}/parameters`,{credentials:"include"});l.ok&&(await l.json()).forEach(I=>{m[I.key]=I.value})}z(m)}catch(t){console.error("Failed to fetch system settings:",t)}};i.useEffect(()=>{f()},[e==null?void 0:e.session.activeOrganizationId]);const R=t=>{u(t)},k=()=>{y(t=>t==="light"?"dark":"light")};i.useEffect(()=>{typeof window>"u"||(c==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",c))},[c]),i.useEffect(()=>{e&&(e.session.activeOrganizationId?n.organization.list().then(({data:t})=>{const o=t==null?void 0:t.find(a=>a.id===e.session.activeOrganizationId);o&&(o.slug.toLowerCase().includes("express")?u(r.EXPRESS):u(r.TURISMO))}):n.organization.list().then(({data:t})=>{if(t&&t.length>0){const o=t.find(a=>a.slug.toLowerCase().includes("turismo"))||t[0];console.log("Setting default active organization:",o.name),n.organization.setActive({organizationId:o.id})}}))},[e]);const A={id:((S=e==null?void 0:e.user)==null?void 0:S.id)||"",name:((h=e==null?void 0:e.user)==null?void 0:h.name)||"Usuário",role:((E=e==null?void 0:e.user)==null?void 0:E.role)||"user",avatar:((v=e==null?void 0:e.user)==null?void 0:v.image)||"",email:((w=e==null?void 0:e.user)==null?void 0:w.email)||""};return P.jsx(O.Provider,{value:{currentContext:d,switchContext:R,currentEmpresa:T[d],user:A,isSidebarOpen:g,toggleSidebar:()=>b(!g),theme:c,toggleTheme:k,systemSettings:C,refreshSettings:f},children:s})},$=()=>{const s=i.useContext(O);if(!s)throw new Error("useApp must be used within AppProvider");return s};export{_ as A,$ as u};
