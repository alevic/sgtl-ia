import{w as te,u as ae,d as re,b as le,a as ne,c as de}from"./chunk-JZWAC4HX-DumfKpwM.js";import{j as e,r as m}from"./forgot-password-Cd1Knve9.js";import{B as O}from"./button-D5icbzZz.js";import{P as ie}from"./PageHeader-BWRrOg2b.js";import{F as D}from"./FormSection-BVV1rFH3.js";import{q as E}from"./types-DFYgxmzW.js";import{c as oe,T as M}from"./rotaValidation-CGbs3Otn.js";import{c as S}from"./createLucideIcon-C45Xejds.js";import{C as z}from"./clock-BRAlDuTD.js";import{S as K}from"./search-CnuVL9vz.js";import{M as B}from"./map-pin-BU3OPG7D.js";import{X as P}from"./x-CitWcJvG.js";import{U as X}from"./users-BFoA2Uj7.js";import{C as G}from"./check-DPa0jV58.js";import{a as N}from"./api-Bkf04Nmd.js";import{L as J}from"./loader-CBdNOhxw.js";import{C as ce}from"./chevron-down-Dfyi3Exh.js";import{P as me}from"./plus-D5F9e-Lx.js";import{D as U}from"./DatePicker-BYHV-MFq.js";import{A as xe,a as ue,b as pe}from"./alert-vCj8ckqs.js";import{S as he}from"./save-QxpYx9ZK.js";import{C as ge}from"./circle-alert-NJ6oZxKs.js";import{B as be}from"./bus-D0L2JeBO.js";import{R as fe}from"./route-BtR-I38-.js";import{D as je}from"./dollar-sign-c_abpx4r.js";import"./utils-CDN07tui.js";import"./card-Cg68uFrF.js";import"./input-emgR2opu.js";import"./popover-BPpg6i3_.js";import"./index-Ds5WWjjE.js";import"./Combination-Bzd-zPU3.js";import"./index-r0Cach5g.js";import"./index-CzPzUr9r.js";import"./index-BDGasEjq.js";import"./index-BTyV9z74.js";import"./admin.drivers.edit._id-CTlVsdej.js";import"./format-Teop82l3.js";import"./chevron-right-DQu5sotq.js";import"./calendar-B2-DO3Xm.js";import"./pt-BR-Dxhrr4Mm.js";import"./index-BHI_vTdI.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],q=S("arrow-right",ve);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],F=S("navigation",Ne);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],we=S("tag",ke),ye=({rota:s,compact:l=!1})=>{if(!s)return e.jsx("div",{className:"bg-slate-100 dark:bg-slate-900 rounded-lg p-8 text-center text-slate-500 dark:text-slate-400",children:"Rota não disponível"});const d=s.duracao_estimada_minutos?Math.floor(s.duracao_estimada_minutos/60):0,f=s.duracao_estimada_minutos?s.duracao_estimada_minutos%60:0;if(l){if(!s.pontos||s.pontos.length<2)return e.jsx("span",{className:"text-red-500 text-sm",children:"Rota inválida (sem pontos)"});const t=s.pontos[0],h=s.pontos[s.pontos.length-1],o=s.pontos.length-2;return e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:t.nome})]}),e.jsx(q,{size:16,className:"text-slate-400"}),o>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-full",children:[o," parada",o>1?"s":""]}),e.jsx(q,{size:16,className:"text-slate-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:h.nome})]}),s.duracao_estimada_minutos&&s.duracao_estimada_minutos>0&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-slate-500 dark:text-slate-400",children:[e.jsx(z,{size:14}),e.jsxs("span",{children:[d,"h ",f,"min"]})]})]})}return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:20,className:"text-blue-600"}),e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-200",children:s.nome||"Rota"})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${s.tipo_rota==="IDA"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"}`,children:s.tipo_rota})]}),(s.duracao_estimada_minutos||s.distancia_total_km)&&e.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[s.duracao_estimada_minutos&&s.duracao_estimada_minutos>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{size:16}),e.jsxs("span",{children:[d,"h ",f,"min"]})]}),s.distancia_total_km&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:16}),e.jsxs("span",{children:[s.distancia_total_km," km"]})]})]}),e.jsxs("div",{className:"relative pl-4 space-y-8",children:[e.jsx("div",{className:"absolute left-[22px] top-4 bottom-4 w-0.5 bg-slate-200 dark:bg-slate-700"}),Array.isArray(s.pontos)&&s.pontos.map((t,h)=>{var b;if(!t)return null;const o=t.tipo==="ORIGEM",g=t.tipo==="DESTINO",p=!((b=t.nome)!=null&&b.toLowerCase().includes(t.tipo.toLowerCase()));return e.jsxs("div",{className:"relative flex gap-4",children:[e.jsx("div",{className:`relative z-10 flex items-center justify-center w-4 h-4 rounded-full border-2 bg-white dark:bg-slate-800 mt-1.5 ${o?"border-green-500":g?"border-red-500":"border-blue-500"}`,children:e.jsx("div",{className:`w-2 h-2 rounded-full ${o?"bg-green-500":g?"bg-red-500":"bg-blue-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-base font-bold text-slate-800 dark:text-slate-200",children:t.nome}),p&&e.jsx("span",{className:`px-2 py-0.5 rounded text-[12px] font-bold uppercase tracking-wider ${o?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":g?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:o?"Origem":g?"Destino":"Parada"})]}),t.observacoes&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:t.observacoes})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 text-sm whitespace-nowrap",children:(()=>{const n=oe(s.pontos)[h];return(t.horario_chegada||t.horario_partida)&&t.horario_chegada&&t.horario_chegada.includes("T"),e.jsxs("div",{className:"flex flex-col items-end text-xs text-slate-500 gap-1",children:[o&&e.jsx("span",{className:"text-green-600 font-medium",children:"Início da viagem"}),!o&&n.tempo_acumulado_minutos!==void 0&&e.jsxs("span",{className:"flex items-center gap-1",title:"Tempo após o início",children:[e.jsx(z,{size:12,className:"text-slate-400"}),"Chegada: +",Math.floor(n.tempo_acumulado_minutos/60),"h ",n.tempo_acumulado_minutos%60,"min"]}),t.duracao_parada_minutos?e.jsxs("span",{className:"text-orange-600 font-medium",children:["Parada: ",t.duracao_parada_minutos," min"]}):null]})})()})]}),t.tipo==="PARADA_INTERMEDIARIA"&&(t.permite_embarque||t.permite_desembarque)&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[t.permite_embarque&&e.jsx("span",{className:"text-[12px] font-medium px-1.5 py-0.5 rounded border border-green-200 text-green-700 bg-green-50 dark:border-green-800 dark:bg-green-900/20 dark:text-green-400",children:"Embarque"}),t.permite_desembarque&&e.jsx("span",{className:"text-[12px] font-medium px-1.5 py-0.5 rounded border border-red-200 text-red-700 bg-red-50 dark:border-red-800 dark:bg-red-900/20 dark:text-red-400",children:"Desembarque"})]})]})]},t.id||h)})]})]})},_e=({rotas:s,tipoFiltro:l,rotaSelecionada:d,onChange:f})=>{var b,j;const[t,h]=m.useState(""),o=m.useMemo(()=>s.filter(n=>{var u,w,v,_,C;const a=n.tipo_rota,i=l,x=(i===E.OUTBOUND||i==="IDA")&&(a===E.OUTBOUND||a==="IDA"),r=(i===E.INBOUND||i==="VOLTA")&&(a===E.INBOUND||a==="VOLTA");if(!x&&!r||!n.ativa)return!1;if(t.trim()){const T=t.toLowerCase(),A=((w=(u=n.pontos[0])==null?void 0:u.nome)==null?void 0:w.toLowerCase())||"",I=((_=(v=n.pontos[n.pontos.length-1])==null?void 0:v.nome)==null?void 0:_.toLowerCase())||"",L=((C=n.nome)==null?void 0:C.toLowerCase())||"";return A.includes(T)||I.includes(T)||L.includes(T)}return!0}),[s,l,t]),g=n=>{(d==null?void 0:d.id)===n.id?f(null):f(n)},p=()=>{f(null)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",value:t,onChange:n=>h(n.target.value),placeholder:"Buscar por origem, destino ou nome...",className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:o.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(B,{size:48,className:"mx-auto text-slate-300 dark:text-slate-600 mb-3"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:t?"Nenhuma rota encontrada":`Nenhuma rota de ${l} disponível`}),e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-2",children:'Cadastre rotas em "Rotas" no menu lateral'})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700 max-h-80 overflow-y-auto",children:o.map(n=>{const a=(d==null?void 0:d.id)===n.id,i=n.pontos[0],x=n.pontos[n.pontos.length-1],r=n.pontos.length-2;return e.jsx("div",{onClick:()=>g(n),className:`p-4 cursor-pointer transition-colors ${a?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-600":"hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold mb-1 truncate ${a?"text-blue-700 dark:text-blue-400":"text-slate-700 dark:text-slate-300"}`,children:n.nome||`${i==null?void 0:i.nome} → ${x==null?void 0:x.nome}`}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 mb-2",children:[e.jsx(B,{size:12}),e.jsxs("span",{className:"truncate",children:[i==null?void 0:i.nome," → ",x==null?void 0:x.nome]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[r>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded",children:[r," parada",r>1?"s":""]}),n.duracao_estimada_minutos&&e.jsxs("span",{className:"px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded flex items-center gap-1",children:[e.jsx(z,{size:10}),Math.floor(n.duracao_estimada_minutos/60),"h",n.duracao_estimada_minutos%60,"min"]}),n.distancia_total_km&&e.jsxs("span",{className:"px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded",children:[n.distancia_total_km," km"]})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 mt-1 ${a?"border-blue-600 bg-blue-600":"border-slate-300 dark:border-slate-600"}`,children:a&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})})]})},n.id)})})}),d&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Rota selecionada"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:d.nome||`${(b=d.pontos[0])==null?void 0:b.nome} → ${(j=d.pontos[d.pontos.length-1])==null?void 0:j.nome}`})]}),e.jsxs("button",{onClick:p,className:"px-3 py-1 text-sm text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(P,{size:14}),"Limpar"]})]})}),d&&e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 px-4 py-2 border-b border-slate-200 dark:border-slate-700",children:e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Preview da Rota"})}),e.jsx("div",{className:"p-4",children:e.jsx(ye,{rota:d,compact:!1})})]})]})},Ce=({motoristas:s,selecionados:l,onChange:d,maxHeight:f="400px"})=>{const[t,h]=m.useState(""),o=m.useMemo(()=>{if(!t.trim())return s;const a=t.toLowerCase();return s.filter(i=>{var x,r;return i.nome.toLowerCase().includes(a)||((x=i.cnh)==null?void 0:x.toLowerCase().includes(a))||((r=i.categoria_cnh)==null?void 0:r.toLowerCase().includes(a))})},[s,t]),g=a=>{l.includes(a)?d(l.filter(i=>i!==a)):d([...l,a])},p=()=>{l.length===s.length?d([]):d(s.map(a=>a.id))},b=()=>d([]),j=l.length===s.length&&s.length>0,n=l.length>0&&!j;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",value:t,onChange:a=>h(a.target.value),placeholder:"Buscar motorista...",className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,ref:a=>{a&&(a.indeterminate=n)},onChange:p,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Selecionar todos"})]}),l.length>0&&e.jsxs("button",{onClick:b,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 flex items-center gap-1",children:[e.jsx(P,{size:14}),"Limpar"]})]}),e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:[l.length," de ",s.length]})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-y-auto",style:{maxHeight:f},children:o.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(X,{size:48,className:"mx-auto text-slate-300 dark:text-slate-600 mb-3"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:t?"Nenhum motorista encontrado":"Nenhum motorista disponível"})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:o.map(a=>{const i=l.includes(a.id);return e.jsxs("label",{className:`flex items-center gap-3 p-3 cursor-pointer transition-colors ${i?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>g(a.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),i&&e.jsx(G,{size:12,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white pointer-events-none"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium truncate ${i?"text-blue-700 dark:text-blue-400":"text-slate-700 dark:text-slate-300"}`,children:a.nome}),(a.categoria_cnh||a.status)&&e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.categoria_cnh&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["CNH: ",a.categoria_cnh]}),a.status&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${a.status==="DISPONIVEL"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:a.status})]})]})]},a.id)})})}),l.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:l.length})," motorista",l.length>1?"s":""," selecionado",l.length>1?"s":""]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:l.slice(0,3).map(a=>{const i=s.find(x=>x.id===a);return i?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 rounded text-xs",children:i.nome},a):null})})]})]})},H={getAll:async s=>{const l=new URLSearchParams;return s!=null&&s.status&&s.status!=="TODOS"&&l.append("status",s.status),s!=null&&s.search&&l.append("search",s.search),N.get(`/api/trips?${l.toString()}`)},getById:async s=>N.get(`/api/trips/${s}`),getSeats:async s=>N.get(`/api/trips/${s}/seats`),create:async s=>N.post("/api/trips",s),update:async(s,l)=>N.put(`/api/trips/${s}`,l),delete:async s=>N.delete(`/api/trips/${s}`),getTags:async()=>N.get("/api/trips/tags"),createTag:async s=>N.post("/api/trips/tags",s),updateTag:async(s,l)=>N.put(`/api/trips/tags/${s}`,l),deleteTag:async s=>N.delete(`/api/trips/tags/${s}`)},Te=({selectedTags:s,onChange:l})=>{const[d,f]=m.useState([]),[t,h]=m.useState(!1),[o,g]=m.useState(!1),[p,b]=m.useState(""),j=m.useRef(null);m.useEffect(()=>{n();const r=u=>{j.current&&!j.current.contains(u.target)&&g(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const n=async()=>{try{h(!0);const r=await H.getTags();f(r)}catch(r){console.error("Error loading tags:",r)}finally{h(!1)}},a=r=>{s.includes(r)?l(s.filter(u=>u!==r)):l([...s,r])},i=async r=>{if(r.key==="Enter"&&p.trim()){r.preventDefault();const u=p.trim();if(s.includes(u)){b("");return}const w=d.find(v=>v.nome.toLowerCase()===u.toLowerCase());if(w)a(w.nome);else try{const v=await H.createTag({nome:u});f(_=>[..._,v]),a(v.nome)}catch(v){console.error("Error creating tag:",v),a(u)}b("")}},x=r=>{l(s.filter(u=>u!==r))};return e.jsxs("div",{className:"relative",ref:j,children:[e.jsxs("div",{className:"min-h-[42px] p-1.5 flex flex-wrap gap-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 rounded-lg cursor-text focus-within:ring-2 focus-within:ring-blue-500 transition-all",onClick:()=>g(!0),children:[s.map(r=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-sm font-medium rounded-md animate-in zoom-in-95",children:[r,e.jsx("button",{onClick:u=>{u.stopPropagation(),x(r)},className:"hover:text-blue-900 dark:hover:text-blue-100 p-0.5 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800/50 transition-colors",children:e.jsx(P,{size:12})})]},r)),e.jsx("input",{type:"text",value:p,onChange:r=>b(r.target.value),onKeyDown:i,onFocus:()=>g(!0),placeholder:s.length===0?"Adicionar tags...":"",className:"flex-1 bg-transparent border-none outline-none text-sm min-w-[120px] dark:text-white"}),e.jsx("div",{className:"flex items-center pr-1 text-slate-400",children:t?e.jsx(J,{size:16,className:"animate-spin"}):e.jsx(ce,{size:16,className:`transition-transform duration-200 ${o?"rotate-180":""}`})})]}),o&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto animate-in fade-in zoom-in-95 duration-100",children:e.jsxs("div",{className:"p-2 space-y-1",children:[t&&d.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-slate-500",children:"Carregando tags..."}):e.jsxs(e.Fragment,{children:[d.filter(r=>r.nome.toLowerCase().includes(p.toLowerCase())).map(r=>e.jsxs("button",{onClick:()=>a(r.nome),className:`w-full flex items-center justify-between px-3 py-2 text-sm rounded-md transition-colors ${s.includes(r.nome)?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":"text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{size:14,className:s.includes(r.nome)?"text-blue-500":"text-slate-400"}),r.nome]}),s.includes(r.nome)&&e.jsx(G,{size:14})]},r.id)),p&&!d.find(r=>r.nome.toLowerCase()===p.toLowerCase())&&e.jsxs("button",{onClick:()=>i({key:"Enter",preventDefault:()=>{},target:{value:p}}),className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/10 rounded-md transition-colors font-medium border-t border-slate-100 dark:border-slate-700 mt-1 pt-2",children:[e.jsx(me,{size:14}),'Criar tag "',p,'"']})]}),!t&&d.length===0&&!p&&e.jsx("div",{className:"p-4 text-center text-sm text-slate-500",children:"Nenhuma tag cadastrada. Digite para criar."})]})})]})},hs=te(function(){const{rotas:l,veiculos:d,motoristas:f,initialViagem:t,isEdicao:h}=ae(),o=re(),g=le(),p=ne(),b=de(),[j,n]=m.useState((t==null?void 0:t.title)||""),[a,i]=m.useState(l.find(c=>c.id===(t==null?void 0:t.route_id))||null),[x,r]=m.useState((t==null?void 0:t.vehicle_id)||""),[u,w]=m.useState(t!=null&&t.driver_id?[t.driver_id]:[]),[v,_]=m.useState((t==null?void 0:t.departure_date)||""),[C,T]=m.useState((t==null?void 0:t.departure_time)||""),[A,I]=m.useState((t==null?void 0:t.arrival_date)||""),[L,Q]=m.useState((t==null?void 0:t.arrival_time)||""),[y,W]=m.useState((t==null?void 0:t.prices)||{}),[R,Y]=m.useState((t==null?void 0:t.tags)||[]),$=g.state==="submitting"||b.state==="submitting",k=d.find(c=>c.id===x),Z=m.useMemo(()=>k!=null&&k.mapa_assentos?Array.from(new Set(k.mapa_assentos.map(c=>c.tipo))):[],[k]),V=()=>{const c={title:j,route_id:a==null?void 0:a.id,vehicle_id:x,driver_id:u[0],departure_date:v,departure_time:C,arrival_date:A,arrival_time:L,price_conventional:y.CONVENCIONAL,price_executive:y.EXECUTIVO,price_semi_sleeper:y.SEMI_LEITO,price_sleeper:y.LEITO,price_bed:y.CAMA,price_master_bed:y.CAMA_MASTER,tags:R,seats_available:(k==null?void 0:k.capacity)||40};b.submit({intent:"save-trip",payload:JSON.stringify(c)},{method:"post"})};return e.jsxs("div",{className:"p-8 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700 pb-10",children:[e.jsx(ie,{title:h?"Editar Escala":"Nova Viagem",subtitle:"Planejamento e alocação de recursos operacionais",backLink:"/admin/trips",rightElement:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(O,{variant:"ghost",onClick:()=>p("/admin/trips"),className:"h-14 rounded-xl px-6 font-bold uppercase text-[12px]",children:"Cancelar"}),e.jsxs(O,{onClick:V,disabled:$,className:"h-14 rounded-xl px-8 bg-primary font-bold uppercase text-[12px] shadow-lg shadow-primary/20",children:[$?e.jsx(J,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(he,{className:"w-4 h-4 mr-2"}),h?"Confirmar Escala":"Criar Viagem"]})]})}),(o==null?void 0:o.error)&&e.jsxs(xe,{variant:"destructive",className:"rounded-3xl border-destructive/20 bg-destructive/5",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(ue,{className:"font-bold uppercase text-[12px]",children:"Erro Operacional"}),e.jsx(pe,{className:"text-xs font-medium",children:o.error})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx(D,{title:"Identificação",icon:be,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[12px] font-semibold uppercase text-muted-foreground ml-1",children:"Título da Viagem"}),e.jsx("input",{value:j,onChange:c=>n(c.target.value),placeholder:"Ex: São Paulo x Rio Express",className:"w-full h-14 px-4 rounded-xl bg-muted/40 border-none font-bold text-[12px] uppercase outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[12px] font-semibold uppercase text-muted-foreground ml-1",children:"Tags"}),e.jsx(Te,{selectedTags:R,onChange:Y})]})]})}),e.jsx(D,{title:"Trajeto e Cronograma",icon:fe,children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(_e,{rotas:l,tipoFiltro:"IDA",rotaSelecionada:a,onChange:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-[11px] font-bold uppercase tracking-widest text-primary",children:"Partida"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(U,{value:v,onChange:_}),e.jsx(M,{value:C,onChange:T})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-[11px] font-bold uppercase tracking-widest text-destructive",children:"Chegada Prevista"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(U,{value:A,onChange:I}),e.jsx(M,{value:L,onChange:Q})]})]})]})]})})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsx(D,{title:"Recursos",icon:X,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[12px] font-semibold uppercase text-muted-foreground ml-1",children:"Veículo"}),e.jsxs("select",{value:x,onChange:c=>r(c.target.value),className:"w-full h-14 px-4 rounded-xl bg-muted/40 border-none font-bold text-[11px] uppercase outline-none appearance-none",children:[e.jsx("option",{value:"",children:"Não Atribuído"}),d.map(c=>e.jsxs("option",{value:c.id,children:[c.placa," - ",c.modelo]},c.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[12px] font-semibold uppercase text-muted-foreground ml-1",children:"Motorista"}),e.jsx(Ce,{motoristas:f,selecionados:u,onChange:w})]})]})}),e.jsx(D,{title:"Tarifário",icon:je,children:e.jsx("div",{className:"space-y-4",children:Z.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-muted/30",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase",children:c.replace("_"," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground",children:"R$"}),e.jsx("input",{type:"number",value:y[c]||"",onChange:ee=>W(se=>({...se,[c]:parseFloat(ee.target.value)})),className:"w-20 bg-transparent text-right font-bold text-sm outline-none"})]})]},c))})})]})]})]})});export{hs as default};
